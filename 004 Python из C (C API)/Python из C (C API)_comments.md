



alec\_kalinin
Wed, 04 Sep 2019 12:40:36 GMT
В своих проектах после долгих размышлений я все-таки отказался от чистого Python API и использовал [Boost.Python](https://www.boost.org/doc/libs/1_71_0/libs/python/doc/html/tutorial/tutorial/embedding.html#tutorial.embedding.using_the_interpreter). Плюс там есть поддержка NumPy, что важно. Пока все работает стабильно.]]>

  
 
https://habr.com/post/466181/#comment\_20586389
https://habr.com/post/466181/#comment\_20586389
04.09.2019 12:40:36 alec\_kalinin


Mixaill
Wed, 04 Sep 2019 13:25:38 GMT
 Как альтернативу можно рассмотреть [pybind11](https://pybind11.readthedocs.io/en/stable/). Почти то же самое, только Boost тащить не нужно.]]>
https://habr.com/post/466181/#comment\_20586587
https://habr.com/post/466181/#comment\_20586587
04.09.2019 13:25:38 Mixaill


MooNDeaR
Wed, 04 Sep 2019 14:40:48 GMT
]]>

В общем, порядок передачи аргументов важен. Есть способ решить эту проблему через флаги -Wl,--start-group и -Wl,--eng-group, но в данном случае это излишне.

  

 Здесь думаю важен порядок подключения линкера -Wl. Кто знает точнее напишите про это в коментах, дополню ответ.Всё довольно просто — символы ищутся в один проход и все неиспользуемые выбрасываются. Если поставить simple.c в конец, то получается, что использование символа Py\_Initialize() линкер увидит после того, как посмотрит в библиотеки питона, все символы которых будут к этому моменту выброшены (потому что не использовались).
https://habr.com/post/466181/#comment\_20586875
https://habr.com/post/466181/#comment\_20586875
04.09.2019 14:40:48 MooNDeaR


pwl
Wed, 04 Sep 2019 17:57:25 GMT
]]>

> 
> 
> When a function passes ownership of a reference on to its caller, the caller is said to receive a new reference. When no ownership is transferred, the caller is said to borrow the reference. **Nothing needs to be done for a borrowed reference.**  
> 
>   
> 
>  Return value: Borrowed reference.  
> 
>  PyObject\* PyDict\_GetItemString(PyObject \*p, const char \*key)  


  

  
```

Py_XDECREF(pVal);
...
pVal = PyDict_GetItemString(pDict, (const char *) val);
```cpp


  

 Проблема с которой я столкнулся и не смог пока понять  
https://habr.com/post/466181/#comment\_20587445
https://habr.com/post/466181/#comment\_20587445
04.09.2019 17:57:25 pwl


Jessy\_James
Wed, 04 Sep 2019 18:38:02 GMT
 
https://habr.com/post/466181/#comment\_20587567
https://habr.com/post/466181/#comment\_20587567
04.09.2019 18:38:02 Jessy\_James


Jessy\_James
Wed, 04 Sep 2019 18:39:35 GMT
 
https://habr.com/post/466181/#comment\_20587575
https://habr.com/post/466181/#comment\_20587575
04.09.2019 18:39:35 Jessy\_James


0xd34df00d
Wed, 04 Sep 2019 20:24:20 GMT
 И именно поэтому в особо запущенных случаях бывает необходимо одну и ту же библиотеку указывать несколько раз.]]>
https://habr.com/post/466181/#comment\_20587803
https://habr.com/post/466181/#comment\_20587803
04.09.2019 20:24:20 0xd34df00d


pwl
Wed, 04 Sep 2019 20:58:24 GMT
А end-group можно не указывать.]]>

Для борьбы с этом достаточно в самом начале указать -Wl,--start-group  

 особо запущенных это не поможет, т.к. особо запущенные — это циклические ссылки.  
https://habr.com/post/466181/#comment\_20587879
https://habr.com/post/466181/#comment\_20587879
04.09.2019 20:58:24 pwl


ybqwer
Wed, 04 Sep 2019 21:17:45 GMT
 
https://habr.com/post/466181/#comment\_20587913
https://habr.com/post/466181/#comment\_20587913
04.09.2019 21:17:45 ybqwer


pvvv
Thu, 05 Sep 2019 10:01:52 GMT
Но всё-таки это взаимодействие туда/сюда в той же в Lua, через стэк, сделано гораздо проще и красивее.]]>

  
 
https://habr.com/post/466181/#comment\_20589567
https://habr.com/post/466181/#comment\_20589567
05.09.2019 10:01:52 pvvv


ybqwer
Thu, 05 Sep 2019 10:32:15 GMT
]]>
слона обучить кататься на роликах тоже надо. Питон это высокоуровневый язык удалённый от железа, С — низкоуровневый, близкий к железу. Кто кого должен вызывать? Принцип иерархии забыли?  

 Так обратно тоже надо,  
https://habr.com/post/466181/#comment\_20589731
https://habr.com/post/466181/#comment\_20589731
05.09.2019 10:32:15 ybqwer


pvvv
Thu, 05 Sep 2019 10:55:52 GMT
Или исходя из вашего принципа иерархии для этого его надо сначала целиком на высокоуровневом питоне переписать, а в качестве скриптового языка расширения наоборот прикрутить tcc какой-нибудь, раз он уровнем пониже?]]>

Всё-таки наверное можно позволить пользователю набрать в консоли a=1; b=a+2; а потом из низкоуровнего C забрать значение 'b' у высокоуровневого питона и что-то с ним дальше делать?  
 
https://habr.com/post/466181/#comment\_20589861
https://habr.com/post/466181/#comment\_20589861
05.09.2019 10:55:52 pvvv


ybqwer
Thu, 05 Sep 2019 11:30:57 GMT
А тут ещё плюсы таким постам ставят]]>

пишем на С что мы со значением дальше делаем и используем это как функцию в более высокоуровневом ( в Питоне считываем с консоли и вызываем функцию С). Тот же принцип софтваредизайна например что низкоуровневая функция не должна вызывать высокоуровневую иначе будет спагетти — код. Тот же принцип что надо избегать GOTO выходы из цикла. Если рассматривать задачу слишком локально (как в твоём примере), то может показаться что удобно сделать так, но это приведёт потом к каше.   

  а потом из низкоуровнего C забрать значение 'b' у высокоуровневого питона и что-то с ним дальше делать?  
https://habr.com/post/466181/#comment\_20590019
https://habr.com/post/466181/#comment\_20590019
05.09.2019 11:30:57 ybqwer


Jessy\_James
Thu, 05 Sep 2019 11:47:10 GMT
Мне было нужно для следующего. Был готовый проект(давно написанный) по обработке данных (парсинг текста и складирование в БД), а поддерживать его надо и появлялись новые форматы данных(которые нужно обрабатывать). И в конце, концов работать со строками в Си надоело, проще их отдать python и получить обработанные данные назад.]]>
 
https://habr.com/post/466181/#comment\_20590097
https://habr.com/post/466181/#comment\_20590097
05.09.2019 11:47:10 Jessy\_James


Jessy\_James
Thu, 05 Sep 2019 12:14:00 GMT
GOTO, break, continue — это jump asm.]]>

  
 
https://habr.com/post/466181/#comment\_20590221
https://habr.com/post/466181/#comment\_20590221
05.09.2019 12:14:00 Jessy\_James


ybqwer
Thu, 05 Sep 2019 12:42:38 GMT
 
https://habr.com/post/466181/#comment\_20590347
https://habr.com/post/466181/#comment\_20590347
05.09.2019 12:42:38 ybqwer


Jessy\_James
Thu, 05 Sep 2019 12:46:48 GMT
 
https://habr.com/post/466181/#comment\_20590373
https://habr.com/post/466181/#comment\_20590373
05.09.2019 12:46:48 Jessy\_James


ybqwer
Thu, 05 Sep 2019 12:53:40 GMT
 парсинг текста и складирование в БД что есть высокоуровневая задача и С там вообще никаким боком не нужен. А можно подетальнее что и как там делалось? в наше цивилизованное время пора задуматься о распаралеливании париснга и прочих операций с текстом.]]>
https://habr.com/post/466181/#comment\_20590409
https://habr.com/post/466181/#comment\_20590409
05.09.2019 12:53:40 ybqwer


Jessy\_James
Thu, 05 Sep 2019 13:05:44 GMT
Есть планировщик который такие таблицы раскидывает по воркерам. Но что бы одну таблицу распарсить нескольких воркерами это будет еще тот геморой )]]>

  

Примерно так.  

  

+-----------+-----------+  

|Val1\_\_\_\_|Val2\_\_\_\_|  

+-----------+-----------+  

|Cell1\_\_\_|Cell2\_\_\_\_|  

+-----------+-----------+  

  
 
https://habr.com/post/466181/#comment\_20590479
https://habr.com/post/466181/#comment\_20590479
05.09.2019 13:05:44 Jessy\_James


pvvv
Thu, 05 Sep 2019 13:51:37 GMT
Хватает случаев когда скриптовый язык нужен лишь в качестве, грубо говоря, достаточно гибкого .ini файла, каким бы высокоуровневым он не был.]]>

Вот уж где каша будет.  

надо переписать его на высокоуровнем питоне, ну чтобы иерархия не нарушалась?   
 
https://habr.com/post/466181/#comment\_20590701
https://habr.com/post/466181/#comment\_20590701
05.09.2019 13:51:37 pvvv


0xd34df00d
Thu, 05 Sep 2019 15:39:01 GMT
]]>

Компания, их использовавшая, имела специальную утилиту, которая пыталась компилировать приложение, утыкалась в ошибки линкера, находила и добавляла нужную библиотеку, начинала снова, и так до достижения неподвижной точки (иногда часами).

 Знаком с системами (кажется, это был то ли AIX, то ли SunOS), где этого нет.  
https://habr.com/post/466181/#comment\_20591051
https://habr.com/post/466181/#comment\_20591051
05.09.2019 15:39:01 0xd34df00d


ybqwer
Thu, 05 Sep 2019 16:57:55 GMT
 . Данные приходят в виде псевдотаблиц откуда приходят, почему в таком виде? Вроде бы в общепринятых форматах типа JSON или YAML прямое отображение в ОО представление и в БД, зачем какой то левый формат юзать]]>
https://habr.com/post/466181/#comment\_20591233
https://habr.com/post/466181/#comment\_20591233
05.09.2019 16:57:55 ybqwer


Jessy\_James
Thu, 05 Sep 2019 21:20:35 GMT
Я то как раз это в json перегоняю.]]>

  

К тому же в те года каналы связи были очень чувствительны к размеру передаваемых данных => придумали гениальное решение все буквы кириллицы которые имеют сходные буквы в латинице заменять на эквиваленты. А (2 байта) ~ A (1 байт), К (2 байта) ~ K (1 байт)  

Вся эта система не мной придумана и не мной отменена будет. Так исторически сложилось годов с 80-х(про json не слышали к сожалению в те года), если не раньше. Каждая таблица имеет несколько страниц, страница размером 80 символов в ширину и 22 строки в высоту. Что бы целиком на старых экранах отображаться в dos или что там тогда было.   
 
https://habr.com/post/466181/#comment\_20591887
https://habr.com/post/466181/#comment\_20591887
05.09.2019 21:20:35 Jessy\_James


grafalex
Mon, 09 Sep 2019 19:00:57 GMT
 выставляем питоновский АПИ как упрощенную альтернативу сишному. Причем приходится работать сразу в обе стороны — и из питоновского сишный код вызывать, так и из сишного в питоновский коллбеки пробрасывать. Причем местами совсем необязательно получается, что один язык более высокоуровневый чем другой. Скорее один модуль на С++, а другой на питоне и друг друга должны уметь вызывать.]]>
https://habr.com/post/466181/#comment\_20603521
https://habr.com/post/466181/#comment\_20603521
09.09.2019 19:00:57 grafalex


khrisanfov
Fri, 13 Sep 2019 22:27:10 GMT
 
https://habr.com/post/466181/#comment\_20622287
https://habr.com/post/466181/#comment\_20622287
13.09.2019 22:27:10 khrisanfov


Jessy\_James
Sat, 14 Sep 2019 21:47:47 GMT
 
https://habr.com/post/466181/#comment\_20624207
https://habr.com/post/466181/#comment\_20624207
14.09.2019 21:47:47 Jessy\_James

Хабр
 https://habrastorage.org/webt/ym/el/wk/ymelwk3zy1gawz4nkejl\_-ammtc.png
https://habr.com/ru/

Sat, 14 May 2022 14:38:39 GMT
habr.com
editor@habr.com
ru
 
https://habr.com/ru/post/466181/
Комментарии к публикации «Python из C (C API)»

xml version="1.0" encoding="UTF-8"?